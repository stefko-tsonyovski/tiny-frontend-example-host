(function(l,y){typeof exports=="object"&&typeof module!="undefined"?y(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],y):(l=typeof globalThis!="undefined"?globalThis:l||self,y(l.secondComponent={},l.tinyFrontendDeps.react))})(this,function(l,y){"use strict";function S(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var g=S(y),M=Object.defineProperty,E=Object.defineProperties,O=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,C=(e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))x.call(t,n)&&C(e,n,t[n]);if($)for(var n of $(t))I.call(t,n)&&C(e,n,t[n]);return e},v=(e,t)=>E(e,O(t));class h extends Error{constructor(t,n,r){super(`Failed to fetch tiny frontend ${t} version ${n} from API, ${r}`);this.name="TinyClientFetchError"}}class F extends Error{constructor(t){super(`Failed to load script for tiny frontend ${t}`);this.name="TinyClientLoadBundleError"}}const L=e=>new Promise(t=>setTimeout(t,e)),p=async(e,t)=>{const{maxRetries:n,delayInMs:r}=t,d=o=>{if(n<=0)throw o;return L(r).then(()=>p(e,{delayInMs:r*2,maxRetries:n-1}))};try{return await e()}catch(o){return d(o)}},j=({timestamp:e,ttlInMs:t})=>t==null||Date.now()-e<t,m=new Map,_=async({tinyFrontendName:e,contractVersion:t,hostname:n,retryPolicy:r={maxRetries:0,delayInMs:0},cacheTtlInMs:d})=>{const o=`${e}-${t}-${n}`,i=m.get(o);if(i&&j({ttlInMs:d,timestamp:i.timestamp}))return i.promise;const s=p(()=>D({tinyFrontendName:e,contractVersion:t,hostname:n}),r).catch(a=>{throw m.delete(o),a});return m.set(o,{promise:s,timestamp:Date.now()}),s},D=async({tinyFrontendName:e,contractVersion:t,hostname:n})=>{let r;try{r=await fetch(`${n}/tiny/latest/${e}/${t}`,{mode:"cors"})}catch(o){throw new h(e,t,`with error: ${o==null?void 0:o.message}`)}if(r.status>=400)throw new h(e,t,`with status ${r.status} and body '${await r.text()}'`);let d;try{d=await r.json()}catch{throw new h(e,t,"while getting JSON body")}return d};(function(e){typeof globalThis!="object"&&(this?t():(e.defineProperty(e.prototype,"_T_",{configurable:!0,get:t}),_T_));function t(){var n=this||self;n.globalThis=n,delete e.prototype._T_}})(Object);const w=new Map,U=e=>T(v(f({},e),{bundleLoader:J})),R=e=>T(v(f({},e),{bundleLoader:W})),T=async({bundleUrl:e,tinyFrontendName:t,dependenciesMap:n,baseCacheKey:r,bundleLoader:d,retryPolicy:o={maxRetries:0,delayInMs:0}})=>{const i=w.get(r);if(i&&i.bundleUrl===e)return i.promise;const s=p(()=>d({bundleUrl:e,dependenciesMap:n,tinyFrontendName:t}),o).catch(a=>{throw w.delete(r),a});return w.set(r,{bundleUrl:e,promise:s}),s},J=async({bundleUrl:e,dependenciesMap:t})=>{const n=await fetch(e);if(n.status>=400)throw new Error(`Failed to fetch umd bundle at URL ${e} with status ${n.status}`);const r=await n.text();return N(r,t)},N=(e,t)=>{const n=globalThis.define;let r;globalThis.define=(d,o)=>{r=o(...d.map(i=>{const s=t[i];return s||console.error(`Couldn't find dependency ${i} in provided dependencies map`,t),s}))},globalThis.define.amd=!0;try{new Function(e)()}finally{globalThis.define=n}if(!r)throw new Error("Couldn't load umd bundle");return r},W=async({bundleUrl:e,tinyFrontendName:t,dependenciesMap:n})=>{const r=document.createElement("script");r.src=e;const d=new Promise((o,i)=>{r.addEventListener("load",()=>{o(window.tinyFrontendExports[t])}),r.addEventListener("error",s=>{try{document.head.removeChild(r)}finally{i(s.error)}})});return window.tinyFrontendDeps=f(f({},window.tinyFrontendDeps),n),document.head.appendChild(r),d},k=async({name:e,contractVersion:t,tinyApiEndpoint:n,dependenciesMap:r={},loadingOptions:d={}})=>{const{retryPolicy:o,cacheTtlInMs:i=2*60*1e3}=d,s=window[`tinyFrontend${e}Config`],a=s!=null?s:await _({tinyFrontendName:e,contractVersion:t,hostname:n,retryPolicy:o,cacheTtlInMs:i});if(a.cssBundle){const c=`${n}/tiny/bundle/${a.cssBundle}`;if(!q(c)){const u=document.createElement("link");u.rel="stylesheet",u.href=c,document.head.appendChild(u)}}try{return await R({bundleUrl:`${n}/tiny/bundle/${a.umdBundle}`,tinyFrontendName:e,dependenciesMap:r,baseCacheKey:`${e}-${t}`,retryPolicy:o})}catch(c){throw console.error(c),new F(e)}},q=e=>!!document.querySelector(`link[rel="stylesheet"][href="${e}"]`),K=async({name:e,contractVersion:t,tinyApiEndpoint:n,dependenciesMap:r={},loadingOptions:d={}})=>{const{retryPolicy:o,cacheTtlInMs:i=2*60*1e3}=d,s=await _({tinyFrontendName:e,contractVersion:t,hostname:n,retryPolicy:o,cacheTtlInMs:i}),a=`${n}/tiny/bundle/${s.umdBundle}`,c=s.cssBundle?`${n}/tiny/bundle/${s.cssBundle}`:void 0;try{const u=await U({bundleUrl:a,tinyFrontendName:e,dependenciesMap:r,baseCacheKey:`${e}-${t}`,retryPolicy:o}),B=`window["tinyFrontend${e}Config"] = ${JSON.stringify(s)}`,H=`
${c?`<link rel="stylesheet" href="${c}">`:""}
<link rel="preload" href="${a}" as="script">
<script>${B}<\/script>`;return{tinyFrontend:u,tinyFrontendStringToAddToSsrResult:H,tinyFrontendSsrConfig:{cssBundle:c,jsBundle:a,moduleConfigScript:B}}}catch(u){throw console.error(u),new F(e)}},b="SecondComponent",P="0.0.1",z=async e=>await K({tinyApiEndpoint:e,name:b,contractVersion:P,dependenciesMap:{react:g.default}}),G=async e=>await k({tinyApiEndpoint:e,name:b,contractVersion:P,dependenciesMap:{react:g.default}});l.loadExampleTinyFrontendClient=G,l.loadExampleTinyFrontendServer=z,Object.defineProperty(l,"__esModule",{value:!0}),l[Symbol.toStringTag]="Module"});
